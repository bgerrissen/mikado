/**
 * @author Ben Gerrissen http://www.netben.nl/ bgerrissen@gmail.com
 * @license MIT
 * 
 * Adapted version of Diego Perini's work.
 *
 * License ORIGINAL version:
 *  http://javascript.nwbox.com/NWEvents/MIT-LICENSE
 * Download ORIGINAL version:
 *  http://javascript.nwbox.com/NWEvents/nwevents.js
 *
 */
mikado.module({path:"home.dom.EventDispatcher",include:["home.lang.ObjectCache"],build:function(J){var I=window,N=I.document,A=N.documentElement;var F=1,B=2,O=3;var Q={"true":F,"false":O};var H=!!(A.addEventListener&&A.removeEventListener);var P=!!(A.attachEvent&&A.detachEvent&&!H);var U=true;var S=new J.ObjectCache();S._get=S.get;S.get=function(X,Y){var M=this._get(X);return M[Y]||(M[Y]=[])};S.put=function(M,X,Y){this.get(M,X).push(Y)};S.remove=function(X,Z,a){var M=this.get(X,Z),Y=a?M.length:(M.length=0);while(Y--){if(M[Y]===a){M.splice(Y,1)}}};var L=function(M){return M.ownerDocument||M.document||M};if("parentWindow" in top.document){var G=function(M){return M.parentWindow||window}}else{if("defaultView" in top.document&&top===top.document.defaultView){var G=function(M){return M.defaultView||window}}else{var G=function(X){if(window.frames.length===0&&top.document===X){return top}else{for(var M in top.frames){if(top.frames[M].document===X){return top.frames[M]}}}return top}}}var R=function(Y,M){var X=Y.length;while(X--){if(M===Y[X]){return true}}return false};if(H&&U){var C=function(M,X){var Y,b=L(M),a=G(b);if(/mouse|click/.test(X)){try{Y=b.createEvent("MouseEvents");Y.initMouseEvent(X,true,true,a,0,0,0,0,0,false,false,false,false,0,null)}catch(Z){Y=b.createEvent("HTMLEvents");Y.initEvent(X,true,true)}}else{if(/key(down|press|out)/.test(X)){Y=b.createEvent("KeyEvents");Y.initKeyEvent(X,true,true,a,false,false,false,false,0,0)}else{Y=b.createEvent("HTMLEvents");Y.initEvent(X,true,true)}}return(M=b=a=Y)};var K=function(X,M,Y){X.addEventListener(M,Y,true)};var E=function(X,M,Y){X.removeEventListener(M,Y,true)};var V=function(X,M){var Y=C(L(X),M);X.dispatchEvent(Y)}}else{if(P&&U){var C=function(M,X){var Y=L(M).createEventObject();return(M=Y)};var K=function(X,M,Y){X.attachEvent("on"+M,Y)};var E=function(X,M,Y){X.detachEvent("on"+M,Y)};var V=function(X,M){var Y=C(X,M);Y.target=X;X.fireEvent("on"+M,Y)}}else{var K=function(X,M,Y){var Z=X["on"+M];if(Z&&Z!==D){S.add(this,M+3,Z)}X["on"+M]=D};var E=function(X,M,Y){};var V=function(X,M){if(typeof X["on"+M]=="function"){X["on"+type](new W(M,this))}}}}var W=function(Y,M,X){this.domEvent=Y||(Y={});if(Y){Y.simulated=true}this.eventPhase=1;this.type=Y.type||X;this.target=Y.target||(Y.target=Y.srcElement)||M;this.timeStamp=+new Date();this.relatedTarget=Y[(Y.target==Y.fromElement?"to":"from")+"Element"];this.keyCode=Y.keyCode||Y.which||0;this.altKey=Y.altKey||Y.altLeft||false;this.ctrlKey=Y.ctrlKey||Y.ctrlLeft||false;this.shiftKey=Y.shiftKey||Y.shiftLeft||false;this.pageX=Y.pageX||Y.clientX||0;this.pageY=Y.pageY||Y.clientY||0;if(W.dataTransport){this.data=W.dataTransport;W.dataTransport=null}};W.prototype={preventDefault:function(){this.returnValue=false;this.domEvent.returnValue=false;if(this.domEvent.preventDefault){this.domEvent.preventDefault()}},stopPropagation:function(){this.cancelBubble=true;this.domEvent.cancelBubble=true;if(this.domEvent.stopPropagation){this.domEvent.stopPropagation()}},stop:function(){this.preventDefault();this.stopPropagation()}};W.supported={};W.isSupported=function(X){var Z;if(W.supported[X]!==Z){return W.supported[X]}var M=function(a){W.supported[X]=((a||I.event).type===X)};try{K(N,X,M);V(N,X,M)}catch(Y){W.supported[X]=false;E(N,X,M)}return W.supported[X]};EventSimulator={invoke:function(Y,c,X){var b=S.get(Y,c.type+X);if(!b){return }c.currentTarget=Y;if(Y===c.target){c.eventPhase=B}var a=b.length,M,Z;while(a--){M=b[a].call(Y,c)===false?false:M}return M},propagate:function(Z){var Y=[];var X=Z.target.parentNode||Z.target.parentObject;var M;while(X){if(R(Y,X)){break}Y.push(X);X=X.parentNode||X.parentObject}X=Y.length;Z.eventPhase=F;while(X--&&!Z.cancelBubble){M=EventSimulator.invoke(Y[X],Z,F)}if(!Z.cancelBubble){M=EventSimulator.invoke(Z.target,Z,F)===false?false:M}if(!Z.cancelBubble){M=EventSimulator.invoke(Z.target,Z,O)===false?false:M}Z.eventPhase=O;while((X=Y.shift())&&!Z.cancelBubble){M=EventSimulator.invoke(X,Z,O)===false?false:M}if(M===false){Z.preventDefault()}return M}};var D=function(M){M=M||I.event;if(!M.simulated){M=new W(M,this);return EventSimulator.propagate(M)}};if(P){K(N,"beforeactivate",function(X){X||(X=I.event);X.target=X.target||X.srcElement;var M=X.target.tagName;if(/^(?:select|input|textarea)/i.test(M)){E(X.target,"change",D);K(X.target,"change",D)}})}function T(M){if(!this.hasOwnProperty||!(this instanceof T)){return(M=new T(M))}this._element=M}T.listen=function(X,Y,Z,M){return new T(X).listen(Y,Z,M)};T.deafen=function(X,Y,Z,M){return new T(X).deafen(Y,Z,M)};T.notify=function(M,X,Y){return new T(M).notify(X,Y)};T.clear=function(M,X){return new T(M).clear(M,X)};T.clearAll=function(M){return new T(M).clearAll()};T._Event=W;T._EventCache=S;T.prototype={listen:function(Y,Z,M){W.isSupported(Y);var X=Y+Q[M||false];S.put(this._element,X,Z);if(Z!==D&&this._element.nodeType){E(this._element,Y,D);K(this._element,Y,D)}return this},deafen:function(X,Y,M){S.remove(this._element,X+Q[M||false],Y);return this},clear:function(M){S.remove(this._element,M+Q[true]);S.remove(this._element,M+Q[false]);return this},clearAll:function(){S.destroy(this._element);return this},notify:function(M,X){W.dataTransport=X;if(W.isSupported(M)&&this._element.nodeType){V(this._element,M)}else{EventSimulator.propagate(new W(null,this._element,M))}return this}};return T}});