(function(){var k={},L={},I={},F={},b=[],Y=0,V=this,P=V.document,i=P.documentElement,X=P.getElementsByTagName("head")[0],Z={timeout:1500,root:function(){var r=P.getElementsByTagName("script"),o=0,p=/\/mikado[^\/\\]*\.js.?$/i,q;while((q=r[o++])){if(p.test(q.src)){return q.src.replace(p,"")}}}(),repositories:{},force:{}},g=P.createElement("script");g.type="text/javascript";var B=function(){},M=Array.prototype.slice,N=function(p,q){if(q){for(var o in q){p[o]=q[o]}}return p},h={},S={listen:function(o,p){if(!h[o]){h[o]=[]}h[o].unshift(p)},deafen:function(p,r){var q=h[p],o;if(q){o=q.length;while(o--){if(q[o]===r){q.splice(o,1)}}}},dispatch:function(p,r){var q=h[p],o;var r=r||{};r.type=p;if(q){o=q.length;while(o--){q[o](r)}}}},a=function(o,p){this.type=o||this.type;this.timestamp=+new Date();N(this,p)};a.prototype={type:"none",message:null,resolution:null,path:null};N(a,{COMPLETE:"complete",LOADING:"loading",LOADED:"loaded",ERROR:"error",DOMREADY:"domReady",RUN:"run",RAN:"ran"});var H=function(o,p){var q=new a(o,p);b.push(q);S.dispatch(o,q)},U=function(){if(!Y){Y=1;S.dispatch(a.DOMREADY)}};if(P.addEventListener){var T=function(){U();P.removeEventListener("DOMContentLoaded",arguments.callee,false);P.removeEventListener("load",arguments.callee,false)};P.addEventListener("DOMContentLoaded",T,false);P.addEventListener("load",T,false)}else{if(P.attachEvent){var G=0;var c=function(){try{i.doScroll("left");G=i.outerHTML.length;if(G*1.03<P.fileSize*1){return setTimeout(c,50)}}catch(o){return setTimeout(c,50)}U()};var j=function(){if(P.readyState!="complete"){c()}else{U()}P.detachEvent("onreadystatechange",arguments.callee);P.detachEvent("load",arguments.callee)};P.attachEvent("onreadystatechange",j);P.attachEvent("load",j)}else{var m=V.onload;V.onload=function(o){U();if(typeof m=="function"){m(o||V.event)}}}}var K=function(o){if(!Y){S.listen(a.DOMREADY,o)}else{o()}};S.listen(a.COMPLETE,function(s){var q=I[s.path];if(!q||!q.length){return }var p=q.length,o,r;while((r=q[--p])){o=r.fetch.length;while(o&&o--){if(r.fetch[o]!=s.path){continue}r.fetch.splice(o,1);if(!r.fetch.length){n(r);q.splice(p,1)}}}});var e=function(p){for(var o in Z.repositories){if(RegExp("^"+o).test(p)){return Z.repositories[o]+p.replace(/\./g,"/")+".js"}}return Z.root+"/"+p.replace(/\./g,"/")+".js"},d=function(o){if(!o.fetch||!o.fetch.length){return false}var q=o.fetch,p=q.length,r;while(p--){r=q[p];if(k[r]){q.splice(p,1);continue}if(!I[r]){J(r,o.timeout)}I[r].push(o)}return q.length?true:false},J=function(p,o){if(k[p]){return false}if(!I[p]){I[p]=[]}L[p]=g.cloneNode(false);L[p].src=e(p);X.appendChild(L[p]);H(a.LOADING,{path:p,timeout:o?Math.max(o,Z.timeout):Z.timeout});return true},O=function(s,p){var r=p?"Dependency '"+s+"'":"";p=p||"Timed out @ "+F[s].timeout+"ms";H(a.ERROR,{path:s,message:p,resolution:"failed silently"});var q=I[s],o=q.length;while(o--){O(q[o].path,p);delete q[o]}delete I[s]};S.listen(a.LOADING,function(o){if(!Z.timeout){return false}F[o.path]={timeout:o.timeout,timeoutID:setTimeout(function(){O(o.path)},o.timeout)};return true});S.listen(a.LOADED,function(o){if(F[o.path]){clearInterval(F[o.path].timeoutID);delete F[o.path]}});var l=function(o){return o?o.split(".").pop():null},E=function(q){var p=q.length,o;while(p--){o=l(q[p]);if(o&&Z.force[o]){q[p]=Z.force[o]}}return q},Q=function(o){o.fetch=o.fetch||[];if(o.include instanceof Array){o.fetch=o.fetch.concat(o.include)}return E(o.fetch)},C=function(o){if(o.allow instanceof Array){var p=o.allow,q;o.allow={};while((q=p.pop())){o.allow[q]=true}}},f=function(q){var s=q.include,r=s.length,p=q.path,o,t;q.library={};while(r--){t=s[r];o=k[t];if(o.allow&&!o.allow[p]){q.library[o.name]="Access denied!";H(a.ERROR,{path:q.path,message:"Disallowed acces to '"+t+"'",resolution:"failed silently"});continue}if(o.traits.domTool){q.traits.domTool=true}if(o.module){q.library[o.name]=o.module}}},W=function(o){var p=o.name||l(o.path),s=o.path||p;if(I[s]){return true}var r=[],q;for(q in I){if(p==l(q)){r.push(q)}}if(r.length===1){o.path=r[0]}else{H(a.ERROR,{path:s,message:"could not resolve path",resolution:"assuming package"})}return true},R=function(o){if(!W(o)){return }o.name=o.name||l(o.path);o.traits=o.traits||{};o.traits.path=o.path;o.traits.name=o.name;C(o);Q(o);H(a.LOADED,o.traits);if(!d(o)){n(o)}},n=function(o){if(o.traits.domBuild&&!Y){K(function(){n(o)});return false}if(o.include instanceof Array){f(o)}if(typeof o.build=="function"){try{o.module=o.build(o.library);delete o.build}catch(p){H(a.ERROR,{error:p,path:o.path,message:"failed to build module",resolution:"failed silently"})}}k[o.path]=o;H(a.COMPLETE,o.traits)};S.listen(a.COMPLETE,function(o){if(L[o.path]){L[o.path].parentNode.removeChild(L[o.path])}delete I[o.path];delete L[o.path]});var A=function(p,q){if(p.traits.domTool&&!Y){return K(function(){A(p,q)})}var r=p.module;if(typeof r=="function"){H(a.RUN,p.traits);B.prototype=r.prototype;var o=new B();r.apply(o,q);H(a.RAN,p.traits)}else{H(a.ERROR,{path:p.path,message:"Nothing is run @ '"+p.path+"'",resolution:"failed silently"})}},D={module:function(o){R(o)},run:function(q){var p=M.call(arguments,1),o=k[q];if(!o){S.listen(a.COMPLETE,function(r){if(r.path==q){A(k[q],p);S.deafen(a.COMPLETE,arguments.callee)}});J(q)}else{A(o,p)}return this},fetch:function(q,p){if(q instanceof Array){var o=q.length;while(o--){J(q[o],p)}}return this},available:function(o){return !!k[o]},config:function(q){for(var p in q){if(/(?:repositories|force)/.test(p)){for(var o in q[p]){if(typeof q[p][o]=="string"){Z[p][o]=q[p][o]}}}else{if(Z[p]){Z[p]=q[p]}}}return this},listen:function(o,p){S.listen(o,p);return this},deafen:function(o,p){S.deafen(o,p);return this},log:b};V.mikado=D})();